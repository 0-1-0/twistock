// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(f){var Z="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),D=function(d,a,g){var b,d=d&&d.constructor==Array&&3==d.length?d:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(d))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(d))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(d))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(d))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(b=0;3>b;++b)d[b]=Math.max(Math.min(d[b]+a[b],255),0);return void 0!=g?"rgba("+d.join(",")+","+g+")":"rgb("+d.join(",")+")"},V=function(d){var a=d.match(/\d+px/i);return a?parseInt(a,10):(a=d.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=d.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},la=function(a){var c=Math.floor(a).toString(),g=parseInt(c.substr(0,1),10);return g*parseFloat("1E"+(c.length-1))==a?a:(g+1)*parseFloat("1E"+(c.length-1))},W=function(a,c){if("object"==typeof c)for(var g in c)a[g]=c[g];return a},ma=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var c=a.target,a={x:a.pageX,y:a.pageY};c.offsetParent;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return a},na=function(a,c,g){var b=V(c.font);if(a.pie)return b=
c.x?2*b:!1===g?0:15,[b,b,b,b];var g=Math.floor(b/2),i=c.marks;return a.vertical?[c.y&&/l/i.test(c.ypos)?b+4:c.x?b:1,c.y?b:1,c.y&&/r/i.test(c.ypos)?b+4:c.x?b:1,c.x?4+c.xwidth:c.y?b:1]:[c.y?g:1,c.y&&/r/i.test(c.ypos)?4+c.ywidth:c.x?b:1,c.x?3+b+i:c.y?b:1,c.y&&/l/i.test(c.ypos)?4+c.ywidth:c.x?g:1]},oa=function(a){for(var c={},a=(a||"line").split(":");a.length;)c[a.pop()]=!0;return c},fa=function(a,c){return c?Math.round(1E3*a/c)/10+"%":"0%"},Q;if(f.canvas)Q=document.getElementById(f.canvas);else a:{var K=
f.container,Ba=f.width||300,Ca=f.height||150;Q=document.createElement("canvas");Q.setAttribute("width",Ba+"px");Q.setAttribute("height",Ca+"px");if(K){if(K="string"==typeof K?document.getElementById(K):K,!K){Q=void 0;break a}}else K=document.body;K.appendChild(Q)}var F=Q,L=F.width,X=F.height,a=F.getContext("2d"),ga,pa=f.background,m=oa(f.mode),S=(f.mode||"line").split(":")[0],qa=(f.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]+/g,"a"),I=parseFloat(f.opacity)||1,$=parseInt(f.linewidth,10)||1,Da=
f.linejoin||"miter",ra=void 0==f.barspace?"a":parseInt(f.barspace,10),sa=parseInt(f.radiuspoint,10)||0,ta=f.autoscale&&/top/i.test(f.autoscale),ha=f.autoscale&&/bot/i.test(f.autoscale),k=W({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,xwidth:0,ywidth:0,ypos:"right"},f.labels),j=!1===f.mouseover?!1:W({radius:5,linewidth:2*$,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},f.mouseover),G,p=[],T=!1,ua,ia,ja,va=f.margins?!1:!0,E=va?na(m,
k,j):f.margins,y=W({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},f.grid),z=f.title?W({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.5)",z:"top"},f.title):!1,u=!1===f.legends?!1:W({color:"#666",font:'10px "Sans Serif"',layout:"v"},f.legends),s=[],R,v,q=0,M,J,U,A,H,B,C,N,r,aa,Y,ba=function(){var d,c,g,b;q=s.length;R=v=!1;J=M=U=0;k.xwidth=0;a.font=k.font;if(q){for(d=0;d<q;d++)c=s[d],R=!1===R?c.min:Math.min(c.min,R),v=!1===v?c.max:Math.max(c.max,v),c.maxlab&&(k.xwidth=Math.max(k.xwidth,a.measureText(c.maxlab).width));
ta&&(v=la(v));k.ywidth=a.measureText(v||"0").width;if(m.stack){d=0;for(g=s[0].len;d<g;++d){for(c=b=0;c<q;++c)b+=s[c].val[d]||0;b>M&&(M=ta?la(b):b)}J=ha?M-R:M}else M=v,J=ha?v-R:v;U=ha?R:0}k.fontpx=V(k.font);"auto"==k.x&&(k.x=1,k.xauto=!0);/none|false/.test(y.x)&&(y.x=[]);/none|false/.test(y.y)&&(y.y=[]);va&&(E=na(m,k,j));A=E[3];H=E[0];B=Math.max(L-E[1]-E[3],0);C=Math.max(X-E[0]-E[2],0);N=A+B;r=H+C},wa=function(a){var c,g=a.values||a,b=a.labels||[],i,h={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,
tit:a.title||"dataset#"+(s.length+1),maxlab:"",col:a.color||Z[s.length%Z.length]};for(c in g)a=parseFloat(g[c]),isNaN(a)&&(a=null),h.val.push(a),i=b[c]||c,i.length>h.maxlab.length&&(h.maxlab=i),h.lab.push(i),h.sum+=a,a>h.max&&(h.max=a),a<h.min&&(h.min=a);h.len=h.val.length;h.avg=h.len?h.sum/h.len:0;s.push(h)},xa=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var c=0,g=a.length;c<g;++c)wa(a[c]);else wa(a);ba()},ca=function(d){var c;switch("a"==qa?m.stack?"v":m.line||m.curve?1<q?"n":"v":
m.chart?1<q?"s":m.vertical?"h":"v":m.pie?"r":"s":qa){case "s":c=D(d,0,I);break;case "l":c=D(d,21,I);break;case "d":c=D(d,-21,I);break;case "v":c=a.createLinearGradient(0,r,0,H);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I));break;case "h":c=a.createLinearGradient(A,0,N,0);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I));break;case "r":c=A+B/2;var g=H+C/2;c=a.createRadialGradient(c,g,0,c,g,C/2);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I))}return c?a.fillStyle=c:!1},O=
function(d){d&&a.hasOwnProperty("shadowBlur")&&(d=d.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(d[0]||1,10),a.shadowOffsetY=parseInt(d[1]||1,10),a.shadowBlur=parseInt(d[2]||1,10),a.shadowColor=d[3]||"#000")},P=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},ya=function(){z&&(O(z.shadow),a.font=z.font,a.textAlign="left",a.textBaseline="top",a.fillStyle=z.color,a.fillText(z.text,void 0==z.x?E[3]+2:z.x,void 0==
z.y?E[0]+2:z.y),P())},da=function(d,c,g,b,i,h){a.save();c=Math.round(c);g=Math.round(g);if(k.x&&0==d%k.x){var e=!0,d=s[0].lab[d]||d,n=0;a.font=k.font;k.xauto&&h&&(n=a.measureText(d).width,e=!("h"==h&&"center"==b&&c-n/2<aa||"v"==h&&g<aa));e&&(O(k.shadow),a.fillStyle=k.color,a.textAlign=b,a.textBaseline=i,a.fillText(d,c,g),P(),aa="center"==b?c+n/2:g+k.fontpx)}k.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(c,r),a.lineTo(c,r+k.marks),a.strokeStyle=k.color,a.stroke());a.restore()},Aa=function(d,c){a.save();
a.font=j.font;var g,b,i,h=d.length,e,n,t=0,l=0,k=V(j.font),f=Math.floor(k/2),m=k+3,x,w,q=L;w=0;x=X;var za=0,p=0;j.sort&&d.sort(function(a,b){return parseFloat(b.v)-parseFloat(a.v)});for(b=0;b<h;b++)p+=d[b].v;for(b=0;b<h;b++)if(e=d[b],i=s[e.nds].lab[e.n],n=s[e.nds].tit,i="function"==typeof j.text?j.text(e.n,e.v,i,e.x,e.y):j.text.replace("%v",e.v).replace("%l",i).replace("%n",e.n).replace("%t",n).replace("%p",e.pct||fa(e.v,p))){e.lines=i.split(/\n|\\n/);e.h=e.lines.length*m;e.h2=Math.floor(e.h/2);e.w=
0;for(g in e.lines)if((i=a.measureText(e.lines[g]).width+6)>e.w)e.w=i;e.w>l&&(l=e.w);t+=e.h;e.r++;q>e.x-e.r&&(q=e.x-e.r);w<e.x+e.r&&(w=e.x+e.r);x>e.y&&(x=e.y);za<e.y&&(za=e.y)}1<h&&(l+=6+k);if(t){t+=3;c?(w=q+(w-q)/2-l/2,w+l>L&&(w=L-1-l)):w+l>=L&&(w=q-l);1>w&&(w=1);w=Math.floor(w);g=w+l;b=x+t/2+t/2;b>r&&(b=r-1);b=Math.floor(b);e=b-t;a.beginPath();a.moveTo(w,b);a.lineTo(g,b);a.lineTo(g,e);a.lineTo(w,e);a.closePath();j.bullet&&(O(j.shadowbox),a.strokStyle="",a.fillStyle=j.bullet,a.fill(),P());j.border&&
(a.lineWidth=1,a.lineJoin="round",a.strokeStyle=j.border,a.stroke());a.textAlign="left";a.textBaseline="top";x=e+3;for(b=0;b<h;b++){e=d[b];t=w+3;1<h&&(a.beginPath(),a.arc(t+f,x+f,f,0,2*Math.PI),a.fillStyle=s[e.nds].col,a.fill(),t+=k+3);O(j.shadow);a.fillStyle=j.color;for(g=0;g<e.lines.length;++g,x+=m)a.fillText(e.lines[g],t,x);P()}}a.restore()},ka={line:function(){var d=q,c=J?C/J:0,g,b,i,h,e,n="curve"==S,t=r+k.marks+2,l=function(a,b,c,d,e,g){for(var h,i,f,k,l,j;e<=g;)if(null===d[e])e++;else if(n){h=
b[e];i=c[e];for(e++;e<=g&&null===d[e];)e++;e>g?a.lineTo(h,i):(f=(h+b[e])/2,k=(i+c[e])/2,l=(h+f)/2,j=(i+k)/2,a.quadraticCurveTo(h,i,l,j),l=(f+b[e])/2,j=(k+c[e])/2,a.quadraticCurveTo(f,k,l,j))}else a.lineTo(b[e],c[e]),e++};a.lineWidth=$;a.lineJoin=Da;for(p=[];g=s[--d];)if(1<(e=g.len)){var f=[],j=[];for(b=0;b<e;++b){h=0;if(m.stack)for(i=0;i<=d;i++)h+=s[i].val[b]-U;else h=g.val[b]-U;f.push(A+Math.round(b*(B/(e-1))));j.push(r-Math.round(c*h))}p.push({x:f,y:j,v:s[d].val,nds:d});b--;f.push(A+Math.round(b*
(B/(e-1))));j.push(r-Math.round(c*h));for(b=0;null===g.val[b];)b++;for(i=e-1;null===g.val[i];)i--;b<=i&&ca(g.col)&&(a.beginPath(),a.moveTo(f[b],r),a.lineTo(f[b],j[b]),l(a,f,j,g.val,b,i),a.lineTo(f[i],r),a.closePath(),a.fill());a.strokeStyle=g.col;a.beginPath();a.moveTo(f[b],j[b]);l(a,f,j,g.val,b,i);a.stroke();if(0==d)for(b=0;b<e;++b)da(b,f[b],t,"center","top","h");if(sa){a.fillStyle=g.col;for(b=0;b<e;++b)void 0!=g.val[b]&&(a.beginPath(),a.arc(f[b],j[b],sa,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){ka.line()},
chart:function(){p=[];if(q){var d,c,g=s[0].len,b="a"==ra?1<q?4:0:ra,i=m.stack?1:q,h=m.vertical?C:B,h=g&&q?(h-b*(g-1))/g/i-1:0,e,n=H,f,l=A,j,u;d=m.vertical?B:C;var y=r+k.marks+2,x=m.stack?M?d/M:0:v?d/v:0;0>h&&(h=0);a.lineWidth=$;a.lineJoin="miter";for(c=0;c<q;c++)p.push({x:[],y:[],v:[],nds:c});if(m.vertical)for(d=0;d<g;d++){da(d,A-k.marks-2,n,"right","top","v");l=A;for(c=0;c<q;c++)e=s[c],j=m.stack?l:A,l=j+Math.round(x*e.val[d]),f=Math.round(n),i=Math.round(n+h),null!==e.val[d]&&(a.beginPath(),a.moveTo(j,
f),a.lineTo(j,i),a.lineTo(l,i),a.lineTo(l,f),a.closePath(),ca(e.col)&&a.fill(),a.strokeStyle=e.col,a.stroke()),p[c].x.push(l),p[c].y.push(Math.floor(n+h/2)),p[c].v.push(e.val[d]),m.stack||(n+=h+1);n+=m.stack?h+1+b:b}else for(d=0;d<g;d++){da(d,l+(h+1)*i/2,y,"center","top","h");n=r;for(c=0;c<q;c++)e=s[c],f=m.stack?n:r,n=f-Math.round(x*e.val[d]),j=Math.round(l),u=Math.round(l+h),null!==e.val[d]&&(a.beginPath(),a.moveTo(j,f),a.lineTo(j,n),a.lineTo(u,n),a.lineTo(u,f),a.closePath(),ca(e.col)&&a.fill(),
a.strokeStyle=e.col,a.stroke()),p[c].x.push(Math.floor(l+h/2)),p[c].y.push(n),p[c].v.push(e.val[d]),m.stack||(l+=h+1);l+=m.stack?h+1+b:b}}},pie:function(){p=[];if(q){var d,c=0,g=[],b=[],i=2*Math.PI,h=[],e=[];if(1<q){var f=0;for(d=0;d<q;d++)f+=s[d].sum;if(f){d=0;for(c=q;d<q;d++)g[d]=s[d].sum/f*i,b[d]=s[d].col,h.push(s[d].sum),e.push(fa(s[d].sum,f))}}else if(f=s[0],f.sum){c=f.len;for(d=0;d<c;d++)g[d]=f.val[d]/f.sum*i,b[d]=Z[d%Z.length],h.push(f.val[d]),e.push(fa(f.val[d],f.sum))}var i=A+Math.round(B/
2),f=H+Math.round(C/2),j=Math.min(C/2,B/2)-1,l=j+k.fontpx,m,r,u=1.5*Math.PI,x,w,y,z,v=T;ua=j;ia=i;ja=f;T=v;a.lineWidth=$;a.lineJoin="miter";for(d=0;d<c;d++)x=u+g[d],w=(u+x)/2,p.push({a:u%(2*Math.PI),n:d}),d===v?(m=i+10*Math.cos(w),r=f+10*Math.sin(w)):(m=i,r=f),a.beginPath(),a.moveTo(m,r),a.arc(m,r,j,u,x,!1),a.closePath(),ca(b[d])&&a.fill(),a.strokeStyle=b[d],a.stroke(),d===v?(y=m+l/2*Math.cos(w),z=r+l/2*Math.sin(w)):da(h[d],m+l*Math.cos(w),r+l*Math.sin(w),"center","middle"),u=x;!1!==v&&Aa([{x:y,y:z,
r:0,v:h[v],pct:e[v],n:v,nds:1<q?v:0}],!0);p.sort(function(a,b){return a.a-b.a})}}},ea={line:function(d,c){var g,b=!1,i,h,e,f=j.linewidth||1,k=[];if(p.length){i=p[0];for(g=0;g<i.x.length;++g)if(void 0!=i.v[g]&&(e=m.vertical?Math.abs(c-i.y[g]):Math.abs(d-i.x[g]),!1===b||e<h))h=e,b=g;if(!1!==b){for(g=0;g<p.length;++g)if(i=p[g],void 0!=i.v[b]){j.border2&&(a.beginPath(),a.lineWidth=f+2,a.arc(i.x[b],i.y[b],j.radius,0,2*Math.PI),0==j.linewidth?(a.fillStyle=j.border2,a.fill()):(a.strokeStyle=j.border2,a.stroke()));
a.beginPath();a.lineWidth=f;a.arc(i.x[b],i.y[b],j.radius,0,2*Math.PI);0==j.linewidth?(a.fillStyle=j.circle,a.fill()):(a.strokeStyle=j.circle,a.stroke());if(j.axis){a.lineWidth=1;if(/x/i.test(j.axis)){for(h=i.y[b]+j.radius;h<r;)a.moveTo(i.x[b],h),h+=2,h>r&&(h=r),a.lineTo(i.x[b],h),h+=2;a.stroke()}if(/y/i.test(j.axis)){for(d=i.x[b]+j.radius;d<N;)a.moveTo(d,i.y[b]),d+=2,d>N&&(d=N),a.lineTo(d,i.y[b]),d+=2;a.stroke()}}k.push({x:i.x[b],y:i.y[b],r:f/2+1+j.radius,v:i.v[b],n:b,nds:i.nds})}Aa(k)}}},chart:function(a,
c){ea.line(a,c)},curve:function(a,c){ea.line(a,c)},pie:function(a,c){var g,b=0;if(Math.sqrt(Math.pow(a-ia,2)+Math.pow(c-ja,2))<=ua){g=Math.PI-Math.atan2(ja-c,a-ia);for(g=(g+3*Math.PI)%(2*Math.PI);b<p.length&&g>p[b].a;)b++;0>--b&&(b=p.length-1);T=p[b].n;Y(!0)}else!1!==T&&(T=!1,Y(!0))}};Y=function(d){aa=-1;a.clearRect(-1,-1,L+1,X+1);pa&&(a.fillStyle=pa,a.fillRect(-1,-1,L+1,X+1));if(!m.pie){var c,g,b;a.lineWidth=y.linewidth||1;a.strokeStyle=y.color;if(y.x){c=0;for(g=y.x.length;c<g;++c)a.beginPath(),
m.vertical?(b=H+Math.round(C*y.x[c]/100),a.moveTo(A,b),a.lineTo(N,b)):(b=A+Math.round(B*y.x[c]/100),a.moveTo(b,H),a.lineTo(b,r)),a.stroke()}if(y.y){c=0;for(g=y.y.length;c<g;++c)a.beginPath(),m.vertical?(b=A+Math.round(B*y.y[c]/100),a.moveTo(b,H),a.lineTo(b,r)):(b=r-Math.round(C*y.y[c]/100),a.moveTo(A,b),a.lineTo(N,b)),a.stroke()}}if(q&&k.y&&!m.pie){var f,h,e=10>J?100:100>J?10:1;O(k.shadow);a.font=k.font;a.fillStyle=k.color;if(m.vertical){a.textAlign="center";c=0;for(g=k.y.length;c<g;++c)b=A+Math.round(B*
k.y[c]/100),h=U+J*k.y[c]/100,h=Math.round(e*h)/e,/r/i.test(k.ypos)&&(f=r+1,a.textBaseline="top",a.fillText(h,b,f)),/l/i.test(k.ypos)&&(f=H-2,a.textBaseline="bottom",a.fillText(h,b,f))}else{a.textBaseline="middle";c=0;for(g=k.y.length;c<g;++c)f=r-Math.round(C*k.y[c]/100),h=U+J*k.y[c]/100,h=Math.round(e*h)/e,/r/i.test(k.ypos)&&(b=N+1,a.textAlign="left",a.fillText(h,b,f)),/l/i.test(k.ypos)&&(b=A-2,a.textAlign="right",a.fillText(h,b,f))}P()}z&&"top"==z.z?(ka[S](),ya()):(ya(),ka[S]());if(!1!==u&&1<q){a.save();
a.font=u.font;var n,t,l,p;g=[];b="h"==u.layout;var v=t=0;f=V(u.font)+3;h=q;var e=f-3,D=6+e;p=b?3+f:3+f*h;l=void 0!=u.x?u.x:E[3]+2;var x=void 0!=u.y?u.y:E[0]+2+(z&&!z.x?2+V(z.font):0);for(c=0;c<h;++c)n=a.measureText(s[c].tit).width,n>t&&(t=n),g.push(n),v+=n;n=b?(D+6)*h+v:9+e+t;a.lineWidth=1;if(t=u.background)O(u.shadowbox),a.fillStyle=t,a.fillRect(l,x,n,p),P();if(t=u.border)a.strokeStyle=t,a.strokeRect(l,x,n,p);c=0;n=x+3;for(l+=3;c<h;++c){p=s[c];O(u.shadow);a.fillStyle=p.col;a.fillRect(l,n,e,e);P();
if(t=u.border2)a.strokeStyle=t,a.strokeRect(l,n,e,e);O(u.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=u.color;a.fillText(p.tit,l+3+e,n);P();b?l+=12+e+g[c]:n+=f}a.restore()}if(!d)if(F.onmouseover=F.onmousemove=F.onmouseout=void 0,T=!1,j){ga=a.getImageData(0,0,L,X);if(G)ea[S](G.x,G.y);F.onmouseover=function(a){G=ma(a)};F.onmousemove=function(b){G&&(m.pie||a.putImageData(ga,0,0),G=ma(b),ea[S](G.x,G.y))};F.onmouseout=function(){G=void 0;a.putImageData(ga,0,0)}}else G=void 0};a.translate(0.5,
0.5);f.datas?xa(f.datas):ba();Y();return{canvas:F,data:s,clear:function(){s=[];q=0;ba();return this},load:function(a){xa(a);return this},cls:function(){return this},draw:function(a){a&&(S=(a||"line").split(":")[0],m=oa(a),ba());Y();return this}}},plotter=harry;