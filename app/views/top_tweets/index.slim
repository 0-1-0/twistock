.row
  .well.block[style='margin-right: 25px']
    h1 Top Tweets
    h3=t :top_tweets_text
    br
    h3.pull-left 
      =t :language
      | : 
    ul.nav.nav-pills.offset1.lang-menu
      li.active#ru-btn lang_class='.#{:russian}'
        a href='#'  =t :russian
      li#en-btn lang_class='.#{:english}'
        a href='#'  =t :english

    h3.pull-left #{t(:categories)}: 
    ul.nav.nav-pills.offset1.menu
      li.active
        a#category-all[href='#']=t :all
      - @categories.each do |category|
        - if category != nil
          li.category-link[class_to_switch='#{category}']
            a[href='#']=category

.row#top-tweets  
  - @users_with_top_tweets.each do |user|
    div[class='well block masonry-item #{user.tweet_category}  #{user.best_tweet_text.language}']
      .top-tweet
        table
          tr
            td=image_tag user.avatar
            td[style='padding-left: 22px']                  
              h3 
                a[href='http://twitter.com/#{user.nickname}' target='blank'] @#{user.nickname}
              h5
                small=user.name
              h5 
                small=t(:one_stock_price) + ': $' + user.share_price.to_s
        .center
          br
          small
            a[href='/profiles/#{user.nickname}'] 
              .btn.btn-small=t :buy   
        br
        - if user.best_tweet_media_url
          - if user.best_tweet_media_url.index('youtube')
            iframe type="text/html" frameborder="0" width="200" height="200" src='#{user.best_tweet_media_url.gsub('watch?','').gsub('v=','v/')}'
          - else
            =image_tag user.best_tweet_media_url
        p=user.best_tweet_text
        a[href='http://twitter.com/#{user.nickname}/status/#{user.best_tweet_id}' target='blank']
          =t :tweet_link
        .pull-right
          a[href='http://twitter.com/intent/retweet?tweet_id=#{user.best_tweet_id}&related=twistockcom' target='blank']
            =t :retweet

=content_for :javascripts do
  javascript:
    var lang_class = '.russian';
    var category_class = '';


    $(document).ready(function(){   

        if(I18n.defaultLocale == 'en'){
          lang_class = '.english';
          $('#en-btn').click();
        };

       $('.masonry-item').each(function(){
          $(this).linkify();
        });

        init_masonry();
    })


    var init_masonry = function(){
      $('.masonry-item').hide();
      $(category_class+lang_class).show();

      $('#top-tweets').masonry({
        itemSelector: category_class + lang_class,
        columnWidth: 14
      });

      $('#header').attr('width', $('#top-tweets').attr('width'))
    };   



    $('#category-all').click(function(){
      category_class = '';

      $('#top-tweets').masonry('destroy');
      init_masonry();
    });

    $('.menu li').click(function(e) {
      $('.menu li').removeClass('active');
      var $this = $(this);
      if (!$this.hasClass('active')) {
        $this.addClass('active');
      }
      e.preventDefault();
    });


    $('.lang-menu li').click(function(e) {
      $('.lang-menu li').removeClass('active');
      var $this = $(this);
      if (!$this.hasClass('active')) {
        $this.addClass('active');
        lang_class = $(this).attr('lang_class');

        $('#top-tweets').masonry('destroy');
        init_masonry();
      }
      e.preventDefault();
    });


    $('.category-link').click(function(){
      $('.masonry-item').hide();

      category_class = '.' + $(this).attr('class_to_switch');
  
  
      $('#top-tweets').masonry('destroy');
      init_masonry();


    });
end
